## Распознавание цифр на штрих-кодах

### Данные

Включает 540 снимков штрих-кодов с разметкой bounding box`ов и цифр.
Скачать данные и их разметку можно по ссылке с [Яндекс.Диск](https://disk.yandex.ru/d/5Wg3tvP7Gywk0g). Либо при помощи команды - будем описано ниже.

Структура папки с данными должна быть следующей:
```
data:
  images - Снимки штрих-кодов:
     image1.jpg
     image2.jpg
  df_train.csv - Файл с разметкой снимков - тренировочная выборка
  df_valid.csv - Файл с разметкой снимков - валидационная выборка
```

### Подготовка проекта 
1. Создание и активация окружения
```
python3.10 -m venv /path/to/new/virtual/environment
```
```
source /path/to/new/virtual/environment/bin/activate
```

2. Установка пакетов

В активированном окружении:
```
pip install -U pip 
pip install -r requirements.txt
```

3. Подготовка данных

В активированном окружении:
```
make prepare_linux
make download_train_data
```

4. Настройка ClearML

Вводим команду, далее следуем инструкциям:
```
clearml-init
```

5. Конфигурация

Для изменения конфигурации обучения необходимо поменять параметры файла [config_file_name.yaml](configs/config.yaml).

6. Запуск обучения
Для запуска обучения запускаем скрипт.
```
export DATA_PATH=DATA_PATH
python train.py configs/config.yaml
```
Перед запуском необходимо изменить путь до папки с данными в переменной `DATA_PATH`.

6. Сохранение весов модели

Изменить путь до чекпоинта модели и путь до сконвертированной модели.
```
PYTHONPATH=. src/convert.py path/to/model.ckpt path/to/model.onnx
dvc add path/to/model.onnx
dvc push path/to/model.onnx.dvc
```

### Использование готовой модели

Результаты экспериментов хранятся в папке [experiments](experiments):

1. Загрузить результаты экспериментов можно при помощи команды:
```
dvc pull path/to/model.onnx.dvc
```

2. Использовать модель на конкретном примере можно при помощи [ноутбука](notebooks/анализ%20результатов.ipynb):


### Дополнительно

1. Данные

Сейчас вырезание кропов из изображения происходит в `__init__` в [файле](src/dataset.py) и сохраняется в список.
Это допустимо для небольшого объёма данных. С ростом объема данных, инициализация будет занимать довольно длительное время.
Чтобы этого избежать, можно нарезать кропы штрих-кодов заранее и немного поправить датасет.

2. Подбор параметров для модели

Перед тем как запускать обучение, необходимо подобрать входной размер изображения и бекбон для CRNN.
Для этого можно использовать [ноутбук](notebooks/подбор параметров.ipynb).
